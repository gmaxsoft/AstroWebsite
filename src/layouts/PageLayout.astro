---
import { SEO } from "astro-seo";
import Menu from "../components/Menu.astro";
import Footer from "../components/Footer.astro";
import HiddenElements from "../components/HiddenElements.astro";
import pl from "../i18n/pl.json";
import en from "../i18n/en.json";

const translations = { pl, en };
const lang = (Astro.params?.lang ?? Astro.props?.lang) as "pl" | "en" || "pl";
const langPrefix = lang === "pl" ? "" : `/${lang}`;
const content = translations[lang]?.index || translations.pl.index;
const contentFooter = translations[lang].footer;
const contentMenu = translations[lang].menu;

const {
  canonical,
  title = content.title, // Tytuł strony (np. z JSON)
  description = content.description, // Opis strony (np. z JSON)
  currentLocale = lang, // Język strony
  ogImage = "/img/default-og.webp", // Obrazek OG
} = Astro.props;

const resolvedCanonical = canonical || `https://www.maxsoft.pl${Astro.url.pathname}`;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <link rel="preload" href="/img/logo-czarne.png" as="image" />
    <link rel="preconnect" href="https://formspree.io" crossorigin />
    <SEO
      title={title}
      description={description}
      canonical={resolvedCanonical}
      openGraph={{
        basic: {
          title: title,
          type: "website",
          image: ogImage,
          url: resolvedCanonical,
        },
        // ...
      }}
    />
  </head>
  <body>
    <div class="mil-wrapper" id="top">
      <Menu data={contentMenu} langPrefix={langPrefix} lang={lang} />
      <div class="mil-curtain"></div>

      <div class="mil-frame">
        <div class="mil-frame-top mil-logo-fixed">
          <a href={langPrefix || "/"} class="mil-logo">Maxsoft</a>

          <div class="mil-lang-switch">
                <a href="/" class:list={["mil-lang-flag", lang === 'pl' ? 'mil-active' : '']}>PL</a>
                <a href="/en/" class:list={["mil-lang-flag", lang === 'en' ? 'mil-active' : '']}>EN</a>
          </div>

          <div class="mil-menu-btn">
            <span></span>
          </div>
        </div>
        <div class="mil-frame-bottom">
          <div class="mil-current-page"></div>
          <div class="mil-back-to-top">
            <a href="#top" class="mil-link mil-dark mil-arrow-place">
              <span>Do góry</span>
            </a>
          </div>
        </div>
      </div>
      <div class="mil-content">
        <div class="mil-main-transition">
          <main id="main">
            <slot />
          </main>
          <Footer data={contentFooter} langPrefix={langPrefix} />
          <HiddenElements />
        </div>
      </div>
    </div>

    
    <script>
      import "../scripts/main.js";
    </script>
  </body>
</html>

<style lang="scss" is:global>
  @import url("../assets/styles/style.scss");
</style>
